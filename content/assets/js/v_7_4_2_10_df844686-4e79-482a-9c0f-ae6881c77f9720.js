import"./v_7_4_2_10_df844686-4e79-482a-9c0f-ae6881c77f9722.js";import{u as S,f as T,i as y,r as E,a as U,b as F,c as u,S as C,d as L,e as M,g as A,h as k,j as v,k as R,l as D,m as I,n as P,o as b,p as W,q as $,s as G,t as O,v as _,w as j,I as N}from"./v_7_4_2_10_df844686-4e79-482a-9c0f-ae6881c77f9723.js";import{i as B,a as q}from"./v_7_4_2_10_df844686-4e79-482a-9c0f-ae6881c77f9719.js";import{u as x}from"./v_7_4_2_10_df844686-4e79-482a-9c0f-ae6881c77f9724.js";import{E as z,R as J,P as h}from"./v_7_4_2_10_df844686-4e79-482a-9c0f-ae6881c77f9710.js";import{i as K,a as H}from"./v_7_4_2_10_df844686-4e79-482a-9c0f-ae6881c77f9725.js";import{i as Q}from"./v_7_4_2_10_df844686-4e79-482a-9c0f-ae6881c77f9726.js";import{i as V}from"./v_7_4_2_10_df844686-4e79-482a-9c0f-ae6881c77f9727.js";import{i as X}from"./v_7_4_2_10_df844686-4e79-482a-9c0f-ae6881c77f9728.js";import{i as Y}from"./v_7_4_2_10_df844686-4e79-482a-9c0f-ae6881c77f9729.js";import{i as Z}from"./v_7_4_2_10_df844686-4e79-482a-9c0f-ae6881c77f9730.js";import{i as tt}from"./v_7_4_2_10_df844686-4e79-482a-9c0f-ae6881c77f9731.js";import"./v_7_4_2_10_df844686-4e79-482a-9c0f-ae6881c77f9732.js";import{s as et}from"./v_7_4_2_10_df844686-4e79-482a-9c0f-ae6881c77f9733.js";import{i as ot}from"./v_7_4_2_10_df844686-4e79-482a-9c0f-ae6881c77f9734.js";import{i as at}from"./v_7_4_2_10_df844686-4e79-482a-9c0f-ae6881c77f9735.js";import"./v_7_4_2_10_df844686-4e79-482a-9c0f-ae6881c77f977.js";import"./v_7_4_2_10_df844686-4e79-482a-9c0f-ae6881c77f974.js";import"./v_7_4_2_10_df844686-4e79-482a-9c0f-ae6881c77f97.js";import"./v_7_4_2_10_df844686-4e79-482a-9c0f-ae6881c77f976.js";import"./v_7_4_2_10_df844686-4e79-482a-9c0f-ae6881c77f978.js";import"./v_7_4_2_10_df844686-4e79-482a-9c0f-ae6881c77f975.js";import"./v_7_4_2_10_df844686-4e79-482a-9c0f-ae6881c77f9718.js";import"./v_7_4_2_10_df844686-4e79-482a-9c0f-ae6881c77f979.js";import"./v_7_4_2_10_df844686-4e79-482a-9c0f-ae6881c77f972.js";import"./v_7_4_2_10_df844686-4e79-482a-9c0f-ae6881c77f973.js";import"./v_7_4_2_10_df844686-4e79-482a-9c0f-ae6881c77f9736.js";import"./v_7_4_2_10_df844686-4e79-482a-9c0f-ae6881c77f9737.js";import"./v_7_4_2_10_df844686-4e79-482a-9c0f-ae6881c77f9738.js";import"./v_7_4_2_10_df844686-4e79-482a-9c0f-ae6881c77f9739.js";import"./v_7_4_2_10_df844686-4e79-482a-9c0f-ae6881c77f9740.js";import"./v_7_4_2_10_df844686-4e79-482a-9c0f-ae6881c77f9741.js";const st=()=>{const t=document.createElement("script");t.src=chrome.runtime.getURL("whatsapp/index.iife.js"),(document.head||document.documentElement).appendChild(t),t.onload=function(){t.remove()}},it=(t,o,i=5e3)=>{const n=Date.now(),p=()=>{document.querySelector(t)?o():Date.now()-n>=i?(console.error(`Erro: O seletor "${t}" não foi encontrado dentro do tempo limite.`),o()):setTimeout(p,300)};p()};it("#app .app-wrapper-web",()=>{st()});async function rt(t,o){return new Promise((i,n)=>{const p=indexedDB.open(t,1);p.onerror=function(s){console.error("Erro ao abrir o banco de dados."),n("Erro ao abrir o banco de dados.")},p.onupgradeneeded=function(s){s.target.result.createObjectStore(o,{keyPath:"id",autoIncrement:!0})},p.onsuccess=function(s){const c=s.target.result,e=c.transaction([o],"readonly").objectStore(o).getAll();e.onsuccess=function(){i(e.result),c.close()},e.onerror=function(){console.error("Erro ao ler os dados da tabela."),n("Erro ao ler os dados da tabela.")}}})}const nt=async()=>{const t=!location.href.includes("https://web.whatsapp");let o=[];if(t)o=await z({stopPropag:!1,action:"getOrderLabels",waitForResponse:!0});else{const i=await rt("useOrderLabels","orderLabels");i[0]&&(o=i[0])}x.setState({orderLabels:o})},ct=async()=>{const t=await J("crm");S.setState({crm:t})};nt();ct();(async()=>(await T(),await y(),B(),E.getState().getNotificaoes(),U()))();function dt(t,o){const i=[],n=[],p=new Set(o.flatMap(a=>a.chats.map(e=>`${e.id}|${a.id}`))),s=new Set(t.flatMap(a=>a.chats.map(e=>`${e.id}|${a.id}`))),c=new Map(o.flatMap(a=>a.chats.map(e=>[`${e.id}|${a.id}`,{chat:e,tabId:a.id}]))),m=new Map(t.flatMap(a=>a.chats.map(e=>[`${e.id}|${a.id}`,{chat:e,tabId:a.id}])));for(const a of s)if(!p.has(a)){const e=m.get(a);e&&i.push({...e,chat:{...e.chat,id:h(e.chat.id)}})}for(const a of p)if(!s.has(a)){const e=c.get(a);e&&n.push({...e,chat:{...e.chat,id:h(e.chat.id)}})}return{chatsAdded:i,chatsRemoved:n}}async function g(t,o,i){for(const{chat:n,tabId:p}of t){const s=o.filter(c=>{var r,d,l;const m=c.funil.abas.some(f=>f.id===p),a=n.id.endsWith("@g.us"),e=((l=(d=(r=c.regras)==null?void 0:r.responderGrupos)==null?void 0:d.propriedades)==null?void 0:l.active)!==!1;return m&&c.acionamento.type===i&&(!a||e)});for(const c of s)try{await C(n.id,c)}catch(m){console.error(`❌ Erro ao disparar follow-up: ${c.id} para chat: ${n.id}`,m)}}}function pt(t,o){t.forEach(({chat:i,tabId:n})=>{o.filter(s=>{var e,r,d;const c=s.funil.abas.some(l=>l.id===n),m=i.id.endsWith("@g.us"),a=((d=(r=(e=s.regras)==null?void 0:e.responderGrupos)==null?void 0:r.propriedades)==null?void 0:d.active)!==!1;return c&&s.acionamento.type==="timing"&&(!m||a)}).forEach(s=>{u.getState().addChatToFollowUp(s.id,n,i,"tab")})})}function lt(t,o){t.forEach(({chat:i,tabId:n})=>{o.filter(s=>{var e,r,d;const c=s.funil.abas.some(l=>l.id===n),m=i.id.endsWith("@g.us"),a=((d=(r=(e=s.regras)==null?void 0:e.responderGrupos)==null?void 0:r.propriedades)==null?void 0:d.active)!==!1;return c&&s.acionamento.type==="timing"&&(!m||a)}).forEach(s=>{u.getState().removeChatFromFollowUp(s.id,n,i.id,"tab")})})}function mt(){F.subscribe(async(t,o)=>{if(!t.userTabs||!u.getState().initSubscribeUserTabs)return;const i=t.userTabs||[],n=o.userTabs||[],p=u.getState().FollowUp.filter(r=>r.active);if(p.length===0)return;const s=n.filter(r=>!i.some(d=>d.id===r.id)),{chatsAdded:c,chatsRemoved:m}=dt(i,n),a=s.flatMap(r=>r.chats.map(d=>({chat:d,tabId:r.id}))),e=m.filter(r=>!a.some(d=>d.chat.id===r.chat.id));if(c.length>0){const r=p.filter(l=>l.acionamento.type==="dispararAoEntrar"),d=p.filter(l=>l.acionamento.type==="timing");r.length>0&&await g(c,r,"dispararAoEntrar"),d.length>0&&pt(c,d)}if(e.length>0){const r=p.filter(f=>f.acionamento.type==="dispararAoSair"),d=e.filter(f=>!s.some(w=>w.id===f.tabId));r.length>0&&d.length>0&&await g(d,r,"dispararAoSair");const l=p.filter(f=>f.acionamento.type==="timing");l.length>0&&lt(e,l)}})}window.addEventListener("message",t=>{if(t.data.type==="Ev"&&t.data.action==="chat.update_label"){const o=JSON.parse(t.data.model);o.chat.id={server:"@"+o.chat.id.split("@")[1],user:o.chat.id.split("@")[0],_serialized:o.chat.id},L.getState().dispartWebhook(o.chat.id.user,"labels",{labels:o.labels,type:o.type})}t.data.type==="Ev"&&t.data.action==="chat.presence_change"&&JSON.parse(t.data.model)});M();A();K();H();k();v();Q();V();X();Y();R();D();Z();tt();I();mt();et({useUserLogin:P,useModal:b,useModalOptions:W});$.subscribe(({label:t})=>{chrome.storage.local.get(["initSystem","userTabs","guardaMsg"],o=>{if(!o.initSystem&&o.userTabs.length===0&&o.guardaMsg.length===0){const{openRendertype:i}=b.getState();t.webhook_login_clients.length!==0?i("ModalLeads",!1,void 0,!0):t.chromeStoreID!=="ahiieliljkcgmghicbgidblclkbklmka"&&t.chromeStoreID!=="likkccegmkoonimkjnmgpadngedknpdk"&&i("Modelo_Selecao",!1)}})});window.addEventListener("message",async t=>{t.data.type==="Ev"&&t.data.action==="webpack.full_ready"&&(G(),O(),await q(),ot(),await _(),j(),at(),N())});
